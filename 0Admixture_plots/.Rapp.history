library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=2
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,mean)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=6
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,mean)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
tbl7
tbl=tbl7
region="Southern_Levant"
apply(tbl[location$Region== region,],2,mean)
tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
admixture_prefix="../../7Admixture/2ADMIXTURE_out_bedfilter_no_indels_altref_altbam/mapQ20/S1minDP2/"
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
tbl=tbl7#
region="Southern_Levant"#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=10
tbl2
tbl7
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))
tbl7
admixture_prefix="../../7Admixture/2ADMIXTURE_out_bedfilter_no_indels_altref_altbam/mapQ25/S1minDP2/"
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))
tbl7
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
admixture_prefix="../../7Admixture/2ADMIXTURE_out_bedfilter_no_indels_altref_altbam/mapQ30/S1minDP2/"
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=1
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=2
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=3
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=4
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=5
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=6
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=7
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=6
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=8
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=5
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=8
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=3
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
rep_number=5
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=6
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=8
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=1
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=10
rep_number=args[4]#
#export_dir="plots/"#
export_dir=args[5]#
#
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=8
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=4
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=5
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=4
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=5
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=9
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
rep_number=1
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix,"merged_rep", rep_number, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
admixture_prefix="../../7Admixture/2ADMIXTURE_out_bedfilter_no_indels_altref_altbam/mapQ30/S1minDP2/merged"
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#
replace_col_name<-function(tbl, region, target_name){#
	tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V8"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V8"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V8"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V8"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V8"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V8"#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", "#9900FF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", customPalette[7])) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", customPalette[-1][7])) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6)],"#CCFFFF", customPalette[-1][3])) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
tbl7
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))
tbl2
tbl7
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4")#
#
tbl2<-replace_col_name(tbl2,"Indian_Ocean", "V1")#
tbl3<-replace_col_name(tbl3,"Indian_Ocean", "V1")#
tbl4<-replace_col_name(tbl4,"Indian_Ocean", "V1")#
tbl5<-replace_col_name(tbl5,"Indian_Ocean", "V1")#
tbl6<-replace_col_name(tbl6,"Indian_Ocean", "V1")#
tbl7<-replace_col_name(tbl7,"Indian_Ocean", "V1")
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()
region="Southern_Levant"
target_name="V6"
tbl=tbl5
tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))
tmp
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))
tmp
tmp2
tmp2<-colnames(tbl)== target_name
tmp2
tmp
colnames(tbl)
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#
region="Southern_Levant"#
target_name="V6"#
tbl=tbl5
tmp<-names(which.max(apply(tbl[location$Region== region,],2,sum)))
tmp2<-colnames(tbl)== target_name
tmp
tmp2
colnames(tbl)
colnames(tbl)[colnames(tbl)==tmp]
colnames(tbl)[tmp2]
tmp
tmp2
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V16")#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V16")#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V16")#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V16")#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V16")#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V16")#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V15")#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V15")#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V15")#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V15")#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V15")#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V15")#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V14")#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V14")#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V14")#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V14")#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V14")#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V14")#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V13")#
tbl3<-replace_col_name(tbl3,"Caucasus", "V13")#
tbl4<-replace_col_name(tbl4,"Caucasus", "V13")#
tbl5<-replace_col_name(tbl5,"Caucasus", "V13")#
tbl6<-replace_col_name(tbl6,"Caucasus", "V13")#
tbl7<-replace_col_name(tbl7,"Caucasus", "V13")#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V12")#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V12")#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V12")#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V12")#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V12")#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V12")#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V18"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V18"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V18"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V18"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V18"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V18"
colnames(tbl7)
colnames(tbl6)
colnames(tbl5)
colnames(tbl4)
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V18"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V18"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V18"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V18"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V18"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V18"
colnames
colnames(tbl2)
location_tmp<-location
location
location_tmp$Region
print(location_tmp,n=100)
location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")
location$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]
location$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"
location<-load_metadata(metadata_filename) %>% right_join(order)
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V16", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V16", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V16", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V16", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V16", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V16", location_tmp)
tbl2
tbl3
tbl2
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))
tbl2
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V8", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V8", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V8", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V8", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V8", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V8", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5", location_tmp)#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5", location_tmp)#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5", location_tmp)#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5", location_tmp)#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5", location_tmp)#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4", location_tmp)#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4", location_tmp)#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4", location_tmp)#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4", location_tmp)#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4", location_tmp)#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3", location_tmp)#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3", location_tmp)#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3", location_tmp)#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3", location_tmp)#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3", location_tmp)#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2", location_tmp)#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2", location_tmp)#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2", location_tmp)#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2", location_tmp)#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2", location_tmp)#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2", location_tmp)#
#
colnames(tbl2)[colnames(tbl2)=="V1"]<-"V18"#
colnames(tbl3)[colnames(tbl3)=="V1"]<-"V18"#
colnames(tbl4)[colnames(tbl4)=="V1"]<-"V18"#
colnames(tbl5)[colnames(tbl5)=="V1"]<-"V18"#
colnames(tbl6)[colnames(tbl6)=="V1"]<-"V18"#
colnames(tbl7)[colnames(tbl7)=="V1"]<-"V18"
colnames(tbl7)
colnames(tbl6)
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"#
#
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
#
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V8", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V8", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V8", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V8", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V8", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V8", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5", location_tmp)#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5", location_tmp)#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5", location_tmp)#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5", location_tmp)#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5", location_tmp)#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4", location_tmp)#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4", location_tmp)#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4", location_tmp)#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4", location_tmp)#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4", location_tmp)#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3", location_tmp)#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3", location_tmp)#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3", location_tmp)#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3", location_tmp)#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3", location_tmp)#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2", location_tmp)#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2", location_tmp)#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2", location_tmp)#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2", location_tmp)#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2", location_tmp)#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2", location_tmp)
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output
colnames(tbl7)
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V8", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V8", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V8", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V8", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V8", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V8", location_tmp)
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3,7)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
tbl2<-replace_col_name(tbl2,"Indian_Ocean", "V1", location_tmp)#
tbl3<-replace_col_name(tbl3,"Indian_Ocean", "V1", location_tmp)#
tbl4<-replace_col_name(tbl4,"Indian_Ocean", "V1", location_tmp)#
tbl5<-replace_col_name(tbl5,"Indian_Ocean", "V1", location_tmp)#
tbl6<-replace_col_name(tbl6,"Indian_Ocean", "V1", location_tmp)#
tbl7<-replace_col_name(tbl7,"Indian_Ocean", "V1", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5", location_tmp)#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5", location_tmp)#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5", location_tmp)#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5", location_tmp)#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5", location_tmp)#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4", location_tmp)#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4", location_tmp)#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4", location_tmp)#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4", location_tmp)#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4", location_tmp)#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3", location_tmp)#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3", location_tmp)#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3", location_tmp)#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3", location_tmp)#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3", location_tmp)#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2", location_tmp)#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2", location_tmp)#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2", location_tmp)#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2", location_tmp)#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2", location_tmp)#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V8", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V8", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V8", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V8", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V8", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V8", location_tmp)#
#
colnames(tbl7)#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(2,1,4,5,6,3)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
tbl2<-replace_col_name(tbl2,"Indian_Ocean", "V1", location_tmp)#
tbl3<-replace_col_name(tbl3,"Indian_Ocean", "V1", location_tmp)#
tbl4<-replace_col_name(tbl4,"Indian_Ocean", "V1", location_tmp)#
tbl5<-replace_col_name(tbl5,"Indian_Ocean", "V1", location_tmp)#
tbl6<-replace_col_name(tbl6,"Indian_Ocean", "V1", location_tmp)#
tbl7<-replace_col_name(tbl7,"Indian_Ocean", "V1", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V7", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V7", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V7", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V7", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V7", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V7", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5", location_tmp)#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5", location_tmp)#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5", location_tmp)#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5", location_tmp)#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5", location_tmp)#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4", location_tmp)#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4", location_tmp)#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4", location_tmp)#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4", location_tmp)#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4", location_tmp)#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3", location_tmp)#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3", location_tmp)#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3", location_tmp)#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3", location_tmp)#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3", location_tmp)#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2", location_tmp)#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2", location_tmp)#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2", location_tmp)#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2", location_tmp)#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2", location_tmp)#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V6", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V6", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V6", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V6", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V6", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V6", location_tmp)#
#
colnames(tbl7)#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#56B4E9")#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) #for lotting in the correct order#
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"#
#
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
#
tbl2<-replace_col_name(tbl2,"Indian_Ocean", "V1", location_tmp)#
tbl3<-replace_col_name(tbl3,"Indian_Ocean", "V1", location_tmp)#
tbl4<-replace_col_name(tbl4,"Indian_Ocean", "V1", location_tmp)#
tbl5<-replace_col_name(tbl5,"Indian_Ocean", "V1", location_tmp)#
tbl6<-replace_col_name(tbl6,"Indian_Ocean", "V1", location_tmp)#
tbl7<-replace_col_name(tbl7,"Indian_Ocean", "V1", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Tabigha_group", "V7", location_tmp)#
tbl3<-replace_col_name(tbl3,"Tabigha_group", "V7", location_tmp)#
tbl4<-replace_col_name(tbl4,"Tabigha_group", "V7", location_tmp)#
tbl5<-replace_col_name(tbl5,"Tabigha_group", "V7", location_tmp)#
tbl6<-replace_col_name(tbl6,"Tabigha_group", "V7", location_tmp)#
tbl7<-replace_col_name(tbl7,"Tabigha_group", "V7", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Southern_Levant", "V6", location_tmp)#
tbl3<-replace_col_name(tbl3,"Southern_Levant", "V6", location_tmp)#
tbl4<-replace_col_name(tbl4,"Southern_Levant", "V6", location_tmp)#
tbl5<-replace_col_name(tbl5,"Southern_Levant", "V6", location_tmp)#
tbl6<-replace_col_name(tbl6,"Southern_Levant", "V6", location_tmp)#
tbl7<-replace_col_name(tbl7,"Southern_Levant", "V6", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Northern_Levant", "V5", location_tmp)#
tbl3<-replace_col_name(tbl3,"Northern_Levant", "V5", location_tmp)#
tbl4<-replace_col_name(tbl4,"Northern_Levant", "V5", location_tmp)#
tbl5<-replace_col_name(tbl5,"Northern_Levant", "V5", location_tmp)#
tbl6<-replace_col_name(tbl6,"Northern_Levant", "V5", location_tmp)#
tbl7<-replace_col_name(tbl7,"Northern_Levant", "V5", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Mediterranean", "V4", location_tmp)#
tbl3<-replace_col_name(tbl3,"Mediterranean", "V4", location_tmp)#
tbl4<-replace_col_name(tbl4,"Mediterranean", "V4", location_tmp)#
tbl5<-replace_col_name(tbl5,"Mediterranean", "V4", location_tmp)#
tbl6<-replace_col_name(tbl6,"Mediterranean", "V4", location_tmp)#
tbl7<-replace_col_name(tbl7,"Mediterranean", "V4", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Caucasus", "V3", location_tmp)#
tbl3<-replace_col_name(tbl3,"Caucasus", "V3", location_tmp)#
tbl4<-replace_col_name(tbl4,"Caucasus", "V3", location_tmp)#
tbl5<-replace_col_name(tbl5,"Caucasus", "V3", location_tmp)#
tbl6<-replace_col_name(tbl6,"Caucasus", "V3", location_tmp)#
tbl7<-replace_col_name(tbl7,"Caucasus", "V3", location_tmp)#
#
tbl2<-replace_col_name(tbl2,"Eastern_Europe", "V2", location_tmp)#
tbl3<-replace_col_name(tbl3,"Eastern_Europe", "V2", location_tmp)#
tbl4<-replace_col_name(tbl4,"Eastern_Europe", "V2", location_tmp)#
tbl5<-replace_col_name(tbl5,"Eastern_Europe", "V2", location_tmp)#
tbl6<-replace_col_name(tbl6,"Eastern_Europe", "V2", location_tmp)#
tbl7<-replace_col_name(tbl7,"Eastern_Europe", "V2", location_tmp)#
#
colnames(tbl7)#
#
library(reshape2)#
library(ggplot2)#
library(stringr)#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(#legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
#pdf("plots/Admixture.pdf", height=7, width=7)#
output#
#dev.off()#
#
#cross_v<-read.table("../../7Admixture/scripts/cross_validation.txt")#
#cross_v$K_param=seq(2,7)#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
plot_order
location$Accession[plot_order]
tbl2<-convert_all_col_names(tbl2,location_tmp)
convert_all_col_names(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}
convert_all_col_names(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}
convert_all_col_names<-function(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}
tbl2<-convert_all_col_names(tbl2,location_tmp)
tbl2
df_melted$variable
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))
df_melted$variable
export_dir="plots"
pdf(paste0(export_dir,"/Admixture.pdf", height=7, width=7)#
output#
dev.off()
pdf(paste0(export_dir,"/Admixture.pdf"), height=7, width=7)#
output#
dev.off()
pdf(paste0(export_dir,"/Admixture.pdf"), height=7, width=7)#
output#
dev.off()
cross_v<-read.table(paste0(admixture_prefix,"CV_error.txt")
cross_v<-read.table(paste0(admixture_prefix,"CV_error.txt"))
cross_v<-read.table(paste0(admixture_prefix,"CV_error.txt"))
cross_v<-read.table(paste0(admixture_prefix,"/CV_error.txt"))
cross_v
cross_v$K_param=seq(2,7)
cross_v
cross_v<-read_tsv(paste0(admixture_prefix,"/CV_error.txt"), col_names=c("CV error"))
cross_v
cross_v$K_param=seq(2,7)
cross_v
select(cross_v, c("CV_error", "K_param"))
cross_v<-read_tsv(paste0(admixture_prefix,"/CV_error.txt"), col_names=c("CV_error"))#
cross_v$K_param=seq(2,7) #
select(cross_v, c("CV_error", "K_param"))
cross_v<-select(cross_v, c("CV_error", "K_param"))
write_csv(cross_v, paste0(admixture_prefix,"CV_error.csv"))
pdf(paste0(export_dir,"/Admixture.pdf"), height=7, width=7)#
output#
dev.off()
ggsave(output, paste0(export_dir,"/Admixture.pdf"), height=7, width=7)
?ggsave
ggsave(paste0(export_dir,"/Admixture.pdf"), output, height=7, width=7)
cross_v<-read_tsv(paste0(admixture_prefix,"/CV_error.txt"), col_names=c("CV_error"))#
cross_v$K_param=seq(2,7) #
cross_v<-select(cross_v, c("CV_error", "K_param"))#
write_csv(cross_v, paste0(admixture_prefix,"CV_error.csv"))#
#ggplot(cross_v, aes(x=K_param,y=cross_v[,2])) + geom_point()
cross_v
write_csv(paste0(admixture_prefix,"CV_error.csv"), cross_v)
write.csv(cross_v, paste0(admixture_prefix,"CV_error.csv"))
getwd()
paste0(admixture_prefix,"CV_error.csv")
write.csv(cross_v, paste0(admixture_prefix,"/CV_error.csv"))
cross_v
cross_v<-select(cross_v, c("CV_error", "K_param"))
cross_v
cross_v<-select(cross_v, c("K_param", "CV_error"))
cross_v
write.csv(data.frame(cross_v), paste0(admixture_prefix,"/CV_error.csv"))
paste0(admixture_prefix,"/CV_error.csv")
write.csv(data.frame(cross_v), paste0(export_dir,"/CV_error.csv"))
write_csv(data.frame(cross_v), paste0(export_dir,"/CV_error.csv"))
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme.minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
args <- commandArgs(trailingOnly = TRUE)#
if (!length(args)==4) {#
  stop("supply arguments: (1) metadata_filename (2) input_fam_file (3) admixture_prefix (4) export_dir")#
} else {#
source("../0Rfunctions/functions.r")#
#
#metadata_filename="../../2Reference_Genomes/Zavitan_v2/metadata/origins.txt"#
metadata_filename=args[1]#
#input_fam_file="../../7Admixture/1LD_pruned_bedfilter_no_indels_altref_altbam/mapQ30/S1minDP2/merged.pruned.fam"#
input_fam_file=args[2]#
#admixture_prefix="../../7Admixture/2ADMIXTURE_out_bedfilter_no_indels_altref_altbam/mapQ30/S1minDP2/merged"#
admixture_prefix=args[3]#
#export_dir="plots"#
export_dir=args[4]#
#
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) # read in order of .fam file to match ADMIXTURE output with location data. #
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
#classify "Tabigha_group" so that the output plot can be properly coloured#
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"#
#
#replace column names so that they are consistent across K and reflect most common 'region' #
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
convert_all_col_names<-function(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}#
#read in data#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#convert column names#
tbl2<-convert_all_col_names(tbl2,location_tmp)#
tbl3<-convert_all_col_names(tbl3,location_tmp)#
tbl4<-convert_all_col_names(tbl4,location_tmp)#
tbl5<-convert_all_col_names(tbl5,location_tmp)#
tbl6<-convert_all_col_names(tbl6,location_tmp)#
tbl7<-convert_all_col_names(tbl7,location_tmp)#
#
#melt the data#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
# first part is the K value used, second part is the population#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
#for colouring the labels#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
#
#to get appropriate labels#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
#location$Accession[plot_order]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
}
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) # read in order of .fam file to match ADMIXTURE output with location data. #
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
#classify "Tabigha_group" so that the output plot can be properly coloured#
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"#
#
#replace column names so that they are consistent across K and reflect most common 'region' #
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
convert_all_col_names<-function(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}#
#read in data#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#convert column names#
tbl2<-convert_all_col_names(tbl2,location_tmp)#
tbl3<-convert_all_col_names(tbl3,location_tmp)#
tbl4<-convert_all_col_names(tbl4,location_tmp)#
tbl5<-convert_all_col_names(tbl5,location_tmp)#
tbl6<-convert_all_col_names(tbl6,location_tmp)#
tbl7<-convert_all_col_names(tbl7,location_tmp)#
#
#melt the data#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
# first part is the K value used, second part is the population#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
#for colouring the labels#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
#
#to get appropriate labels#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
#location$Accession[plot_order]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
library(readr)#
library(dplyr)#
library(stringr)#
library(ggplot2)#
#
full_traw_path<-"../../5Variants/3Modern_Samples_Merge_bedfilter/merged.traw"#
traw_full<-read_tsv(full_traw_path)#
traw_full_geno<-traw_full[,7:ncol(traw_full)]#
alts<-apply(traw_full_geno,2,sum,na.rm=TRUE)/(2*apply(!is.na(traw_full_geno),2,sum))#
extension="all_sites"#
tmp<-data.frame(name=names(alts), non_reference_allele_frac=alts) %>% tbl_df() %>%#
	mutate(#
		Accession=ifelse(grepl("Mt_", name)| grepl("Iraq_", name), paste0(word(name,1,sep="_"),"_", word(name,2,sep="_")), word(name,1,sep="_")), #
		type=ifelse(Accession %in% c("UC10164S1", "Outgroup"), Accession, "other"),#
		extension=paste0(extension))#
#
get_alts_by_SNP_type<-function(traw_path){#
	traw<-read_tsv(traw_path)#
	mutate(traw, change=paste(COUNTED, ALT, sep="_")) %>% group_by(change) %>%#
	summarise_at(#
		colnames(traw)[7:ncol(traw)],#
		function(x)(sum(x,na.rm=TRUE)/(2*sum(!is.na(x))))#
	) %>%#
	tidyr::gather(key="Accession", value="ALT", -change) %>%#
	mutate(Accession=ifelse(grepl("Mt_", Accession)| grepl("Iraq_", Accession), paste0(word(Accession,1,sep="_"),"_", word(Accession,2,sep="_")), word(Accession,1,sep="_")))#
}#
#
get_data_frame<-function(mapQfilter, extension){#
	alts_by_SNP<-get_alts_by_SNP_type(paste0("../../5Variants/3Modern_Samples_Merge_",extension, "/mapQ", mapQfilter, "/S1minDP2/merged.traw"))#
	plotter<-data.frame(name=names(alts), non_reference_allele_frac=alts) %>% tbl_df() %>%#
		mutate(#
			Accession=ifelse(grepl("Mt_", name)| grepl("Iraq_", name), paste0(word(name,1,sep="_"),"_", word(name,2,sep="_")), word(name,1,sep="_")), #
			type=ifelse(Accession %in% c("UC10164S1", "Outgroup"), Accession, "other"),#
			extension=paste0(extension))#
}#
#
mapQfilter=30#
extension= "bedfilter_noindels_altref_altbam"#
alts_by_SNP<-get_alts_by_SNP_type(paste0("../../5Variants/3Modern_Samples_Merge_",extension, "/mapQ", mapQfilter, "/S1minDP2/merged.traw"))#
#combine with metadata about location etc. #
location<-read.table("../../2Reference_Genomes/Zavitan_v2/metadata/origins.txt", stringsAsFactors=FALSE, header=TRUE) %>% tbl_df() %>% #
	rbind(c("UC10164S1","Egypt","UC10164S1", "dicoccum", "ancient", "Ancient_Egyptian", 26.93, 31.48)) %>%#
	rbind(c("Outgroup", NA, "Outgroup", "Outgroup", "Outgroup", "Outgroup", NA,NA))#
#
plotter<-left_join(alts_by_SNP, location)#
#
label_names<- c("Ancient Egyptian", "Caucasus (Dom)", "Eastern Europe (Dom)", "Indian Ocean (Dom)", "Mediterranean (Dom)", "Northern Levant (Wild)", "Outgroup", "Southern Levant (Wild)")#
customPalette <- c("#000000", "#E69F00", "#D55E00", "#009E73", "#CC79A7", "#000066", "#888888", "#56B4E9", "#999999")#
#
filter(plotter, !Accession %in% c("Outgroup", "UC10164S2")) %>%#
ggplot(aes(x= ALT, fill= Improvement_status)) +#
	geom_histogram(binwidth=0.005) +#
	facet_wrap(~ change, ncol=1) +#
	xlab("% non-reference alleles") +#
	theme_minimal() +#
	scale_fill_manual(labels= label_names , values= customPalette)+#
	scale_fill_manual(values= customPalette[c(1,3,8)])+#
NULL
transition_plot<-filter(plotter, !Accession %in% c("Outgroup", "UC10164S2")) %>%#
ggplot(aes(x= ALT, fill= Improvement_status)) +#
	geom_histogram(binwidth=0.005) +#
	facet_wrap(~ change, ncol=1) +#
	xlab("% non-reference alleles") +#
	theme_minimal() +#
	scale_fill_manual(labels= label_names , values= customPalette)+#
	scale_fill_manual(values= customPalette[c(1,3,8)])+#
NULL
ggsave("test.pdf", transition_plot, width=7, height=14)
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
order<-read_delim(input_fam_file, col_names=FALSE, delim=" ") %>% mutate(Accession=X1) %>% select(Accession) # read in order of .fam file to match ADMIXTURE output with location data. #
location<-load_metadata(metadata_filename) %>% right_join(order)#
#
#classify "Tabigha_group" so that the output plot can be properly coloured#
location_tmp<-location#
location_tmp$Region[location_tmp$Accession %in% c("Tabigha", "PI467008", "PI470962", "PI466950", "PI471021")]<-"Tabigha_group"#
#
#replace column names so that they are consistent across K and reflect most common 'region' #
replace_col_name<-function(tbl, region, target_name, location_tmp){#
	tmp<-names(which.max(apply(tbl[location_tmp$Region== region,],2,sum)))#
	tmp2<-colnames(tbl)== target_name#
	colnames(tbl)[colnames(tbl)==tmp]<-target_name#
	colnames(tbl)[tmp2]<-tmp#
	return(tbl)#
}#
convert_all_col_names<-function(tbl,location_tmp){#
	tbl<-replace_col_name(tbl,"Indian_Ocean", "V1", location_tmp)#
	tbl<-replace_col_name(tbl,"Tabigha_group", "V7", location_tmp)#
	tbl<-replace_col_name(tbl,"Southern_Levant", "V6", location_tmp)#
	tbl<-replace_col_name(tbl,"Northern_Levant", "V5", location_tmp)#
	tbl<-replace_col_name(tbl,"Mediterranean", "V4", location_tmp)#
	tbl<-replace_col_name(tbl,"Caucasus", "V3", location_tmp)#
	tbl<-replace_col_name(tbl,"Eastern_Europe", "V2", location_tmp)#
}#
#read in data#
tbl2<-read.table(paste0(admixture_prefix,"/merged.pruned.2.Q"))#
tbl3<-read.table(paste0(admixture_prefix, "/merged.pruned.3.Q"))#
tbl4<-read.table(paste0(admixture_prefix, "/merged.pruned.4.Q"))#
tbl5<-read.table(paste0(admixture_prefix, "/merged.pruned.5.Q"))#
tbl6<-read.table(paste0(admixture_prefix, "/merged.pruned.6.Q"))#
tbl7<-read.table(paste0(admixture_prefix, "/merged.pruned.7.Q"))#
#convert column names#
tbl2<-convert_all_col_names(tbl2,location_tmp)#
tbl3<-convert_all_col_names(tbl3,location_tmp)#
tbl4<-convert_all_col_names(tbl4,location_tmp)#
tbl5<-convert_all_col_names(tbl5,location_tmp)#
tbl6<-convert_all_col_names(tbl6,location_tmp)#
tbl7<-convert_all_col_names(tbl7,location_tmp)#
#
#melt the data#
df<-data.frame(Accession= location$Accession, Improvement_status= location$Improvement_status, Region= location$Region, K2=tbl2,K3=tbl3, K4=tbl4, K5=tbl5, K6=tbl6, K7=tbl7)#
df_melted<-melt(df, id.vars = c("Accession","Improvement_status", "Region"))#
# first part is the K value used, second part is the population#
df_melted$Kvalue=word(df_melted$variable,1,sep="\\.")#
df_melted$variable=word(df_melted$variable,2,sep="\\.")#
#
#for colouring the labels#
colours<-sapply(as.numeric(as.factor(df$Region[order(df$Region)])), function(x)(customPalette[x]))#
#
#to get appropriate labels#
location$label_number<-as.numeric(gsub("UC10164S1","10164",gsub("[A-Z][A-Z]\\-","",location$Label)))#
plot_order<-order(factor(location$Region, levels=rev(c("Ancient_Egyptian", "Indian_Ocean", "Mediterranean", "Eastern_Europe", "Caucasus", "Northern_Levant", "Southern_Levant"))), location$label_number)#
plot_order<-plot_order[c(11:14,10,1:9,15:65)]#
#location$Accession[plot_order]#
colours<-sapply(as.numeric(as.factor(location $Region)), function(x)(customPalette[x]))[plot_order]#
#
df_melted$Kvalue<-gsub("K", "K=",df_melted$Kvalue)#
#
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
output
source("../0Rfunctions/functions.r")
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    scale_x_continuous(breaks = scales::pretty_breaks(n = 5))#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    scale_x_continuous(breaks = scales::pretty_breaks(n = 5)),#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
scales::pretty_breaks(n = 5)
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  scale_x_continuous(breaks = scales::pretty_breaks(n = 5))#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  scale_x_continuous(breaks = scales::pretty_breaks(n = 5))+#
  theme(legend.position='none',#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
?theme
? axis.ticks.x
?axis.ticks.x
?axis.ticks
??axis.ticks
ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.ticks.x= element_line(),#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL
output<-ggplot(df_melted, aes(x= factor(Accession, levels=df$Accession[plot_order]), y=value, fill=variable)) + #
  geom_bar(stat = "identity") +#
  ylab("Ancestry") +#
  xlab("Accession") +#
  theme_minimal() +#
  theme(legend.position='none',#
    axis.ticks.x= element_line(),#
    axis.text.x = element_blank(),#
    axis.title.x= element_text(),#
    axis.title.y= element_text(),#
    axis.text.y = element_text(colour = colours)) +#
  coord_flip() +#
  scale_fill_manual(values = c(customPalette[-1][c(3,2,1,4,5,6)],"#CCFFFF")) +#
  facet_wrap(~ Kvalue, nrow=1) +#
  NULL#
#
ggsave(paste0(export_dir,"/Admixture.pdf"), output, height=7, width=7)
